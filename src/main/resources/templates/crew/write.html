<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

<!--    <link rel="canonical" href="https://getbootstrap.kr/docs/5.1/examples/checkout/">-->
<!--    &lt;!&ndash; Bootstrap core CSS &ndash;&gt;-->
<!--    <link href="/docs/5.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Favicons -->
<!--    ë‹¬ë ¥-->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" >
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.891.0.min.js"></script>



    <meta name="theme-color" content="#7952b3">

    <style>


        .slidecontainer {
            width: 100%;
            margin-top: 100px;
        }

        .slider {
            -webkit-appearance: none; /* ê¸°ë³¸ CSS ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œ */
            width: 200%; /* ìŠ¬ë¼ì´ë” ê¸¸ì´ */
            height: 15px; /* ìŠ¬ë¼ì´ë” ë‘ê»˜ */
            border-radius: 5px; /* ìŠ¬ë¼ì´ë” ëª¨ì„œë¦¬ë¥¼ ì•½ê°„ ë‘¥ê¸€ê²Œ */
            background: #ccc; /* ìŠ¬ë¼ì´ë” ìƒ‰ìƒ */
            outline: none; /* ìŠ¬ë¼ì´ë” í…Œë‘ë¦¬ ì—†ì´ */
        }

        /* ìŠ¬ë¼ì´ë” í•¸ë“¤(í´ë¦­í•´ì„œ ë“œë˜ê·¸í•˜ëŠ” ë¶€ë¶„) ì»¤ìŠ¤í…€
        (Chrome, Opera, Safari, Edge ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•´ì„œëŠ” -webkit-ì„,
        Firefox ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•´ì„œëŠ” -moz- ë¥¼ ì‚¬ìš©í•˜ì„¸ìš” */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none; /* ê¸°ë³¸ CSS ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œ */
            appearance: none; /* ê¸°ë³¸ CSS ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œ */
            width: 100px; /* ìŠ¬ë¼ì´ë” í•¸ë“¤ ê¸¸ì´ */
            height: 25px; /* ìŠ¬ë¼ì´ë” í•¸ë“¤ ë†’ì´ */
            border-radius: 50%; /* í•¸ë“¤ ëª¨ì–‘ì„ ì›ëª¨ì–‘ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•¨ */
            background: #00f; /* ìŠ¬ë¼ì´ë” í•¸ë“¤ ìƒ‰ìƒ */
            cursor: pointer; /* ìŠ¬ë¼ì´ë” í•¸ë“¤ì— ë§ˆìš°ìŠ¤ë¥¼ ê°–ë‹¤ëŒ€ë©´ í¬ì¸í„°ë¡œ ë³€ê²½ */
        }

        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }
        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
        .container {
            max-width: 960px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container">
    <main>
        <div class="py-5 text-center">

            <h2>ğŸ‰ ìš´ë™ë©” ëª¨ì§‘í•˜ê¸°</h2>
            <p class="lead">ê°„ë‹¨í•œ ëª¨ì„ì„ ì´ë£¨ì–´ ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ê³¼ ìš´ë™í•˜ê¸°</p>
        </div>
        <div class="row">
            <div class="col">
                <h4 class="mb-3">ìš´ë™ë©” ëª¨ì§‘ ì–‘ì‹</h4>

                    <div class="row g-3">
                        <div>
                        <th:block th:each="sport : ${sportEnums}">
                            <label class="btn btn-outline-secondary"> <input name="sportradio" type="radio" th:value="${sport}" th:text="${sport}">

                            </label>
                        </th:block>
                        </div>

                        <div class="col-12">
                            <label for="title" class="form-label">ìš´ë™ë©” ì œëª©</label>
                            <input type="text" class="form-control" id="title" placeholder="ëª¨ì„í•˜ê³ ì‹¶ì€ ì´ë¦„" required>
                            <div class="invalid-feedback">
                                ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!
                            </div>
                        </div>

                        <div class="col-12">
                            <label for="content" class="form-label">ì„¸ë¶€ ë‚´ìš©ì…ë ¥<span class="text-muted">(Optional)</span></label>
                            <textarea class="form-control" id="content" placeholder="ëª¨ì„ì˜ ì„¸ë¶€ë‚´ìš©"></textarea>
                        </div>

                    </div>

                    <hr class="my-4">
                <!--                    ë‹¬ë ¥ ìº˜ë¦°ë” -->
                    <div class="row">
                        <div class="col">
                            <label class="form-label" for="datepicker">ë‚ ì§œ</label>
                        <input type="date" class="form-control" id="datepicker" dataformatas="yyyy-mm-dd">
                        </div>
                        <div class="col">
                            <label class="form-label" for="datepicker">ì‹œê°„</label>
                        <input type="time" class="form-control" id="timepicker">
                        </div>
                    </div>

                    <script>
                        $('#datepicker')
                            .datepicker({
                                dateFormat: 'yy-mm-dd'//ë°ì´í„° í¬ë§· í˜•ì‹(yyyy : ë…„ mm : ì›” dd : ì¼ )
                            })
                            .on('changeDate', function (e) {
                                console.log(e);
                                // e.dateë¥¼ ì°ì–´ë³´ë©´ Thu Jun 27 2019 00:00:00 GMT+0900 (í•œêµ­ í‘œì¤€ì‹œ) ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ ë³´ì¸ë‹¤.
                            });
                    </script>

                    <hr class="my-4">


                <div class="col-12">
                    <!-- ì¹´ì¹´ì˜¤ ì§€ë„ api -->
                    <div id="map" style="width:500px;height:400px;"></div>
                    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=99a93a891ef6fc1b81b324cfbe0ba2c0&libraries=services"></script>
                    <script>
                        var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
                            mapOption = {
                                center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                                level: 1 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                            };

                        // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                        var map = new kakao.maps.Map(mapContainer, mapOption);

                        // ì£¼ì†Œ-ì¢Œí‘œ ë³€í™˜ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                        var geocoder = new kakao.maps.services.Geocoder();

                        var marker = new kakao.maps.Marker(), // í´ë¦­í•œ ìœ„ì¹˜ë¥¼ í‘œì‹œí•  ë§ˆì»¤ì…ë‹ˆë‹¤
                            infowindow = new kakao.maps.InfoWindow({zindex:1}); // í´ë¦­í•œ ìœ„ì¹˜ì— ëŒ€í•œ ì£¼ì†Œë¥¼ í‘œì‹œí•  ì¸í¬ìœˆë„ìš°ì…ë‹ˆë‹¤

                        // í˜„ì¬ ì§€ë„ ì¤‘ì‹¬ì¢Œí‘œë¡œ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì„œ ì§€ë„ ì¢Œì¸¡ ìƒë‹¨ì— í‘œì‹œí•©ë‹ˆë‹¤
                        searchAddrFromCoords(map.getCenter(), displayCenterInfo);

                        // ì§€ë„ë¥¼ í´ë¦­í–ˆì„ ë•Œ í´ë¦­ ìœ„ì¹˜ ì¢Œí‘œì— ëŒ€í•œ ì£¼ì†Œì •ë³´ë¥¼ í‘œì‹œí•˜ë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                            searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {
                                if (status === kakao.maps.services.Status.OK) {
                                    var detailAddr = !!result[0].road_address ? '<div>ë„ë¡œëª…ì£¼ì†Œ : ' + result[0].road_address.address_name + '</div>' : '';
                                    var detailAddrValue = !!result[0].road_address ? result[0].road_address.address_name+" " : "";
                                    document.getElementById("address_kakao").value = detailAddrValue;
                                    detailAddr += '<div>ì§€ë²ˆ ì£¼ì†Œ : ' + result[0].address.address_name + '</div>';
                                    document.getElementById("address_detail").value = result[0].address.address_name+" ";



                                    var content = '<div class="bAddr">' +
                                        '<span class="title">ë²•ì •ë™ ì£¼ì†Œì •ë³´</span>' +
                                        detailAddr +
                                        '</div>';

                                    // ë§ˆì»¤ë¥¼ í´ë¦­í•œ ìœ„ì¹˜ì— í‘œì‹œí•©ë‹ˆë‹¤
                                    marker.setPosition(mouseEvent.latLng);
                                    marker.setMap(map);

                                    // ì¸í¬ìœˆë„ìš°ì— í´ë¦­í•œ ìœ„ì¹˜ì— ëŒ€í•œ ë²•ì •ë™ ìƒì„¸ ì£¼ì†Œì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
                                    infowindow.setContent(content);
                                    infowindow.open(map, marker);
                                }
                            });
                        });

                        // ì¤‘ì‹¬ ì¢Œí‘œë‚˜ í™•ëŒ€ ìˆ˜ì¤€ì´ ë³€ê²½ëì„ ë•Œ ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œì— ëŒ€í•œ ì£¼ì†Œ ì •ë³´ë¥¼ í‘œì‹œí•˜ë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                        kakao.maps.event.addListener(map, 'idle', function() {
                            searchAddrFromCoords(map.getCenter(), displayCenterInfo);
                        });

                        function searchAddrFromCoords(coords, callback) {
                            // ì¢Œí‘œë¡œ í–‰ì •ë™ ì£¼ì†Œ ì •ë³´ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤
                            geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);
                        }

                        function searchDetailAddrFromCoords(coords, callback) {
                            // ì¢Œí‘œë¡œ ë²•ì •ë™ ìƒì„¸ ì£¼ì†Œ ì •ë³´ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤
                            geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
                        }

                        // ì§€ë„ ì¢Œì¸¡ìƒë‹¨ì— ì§€ë„ ì¤‘ì‹¬ì¢Œí‘œì— ëŒ€í•œ ì£¼ì†Œì •ë³´ë¥¼ í‘œì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
                        function displayCenterInfo(result, status) {
                            if (status === kakao.maps.services.Status.OK) {
                                var infoDiv = document.getElementById('centerAddr');

                                for(var i = 0; i < result.length; i++) {
                                    // í–‰ì •ë™ì˜ region_type ê°’ì€ 'H' ì´ë¯€ë¡œ
                                    if (result[i].region_type === 'H') {
                                        infoDiv.innerHTML = result[i].address_name;
                                        break;
                                    }
                                }
                            }
                        }
                    </script>

                </div>


                <hr class="my-4">
                <div class="row">
                    <div class="col">
                        <input type="file" accept="image/*" id="imageFile"/>
                        <button type="button" onclick="profileUpload()"> ì—…ë¡œë“œ </button>
                        <input type="hidden" value="" name="imagePath" id="imagePath"/>
                    </div>
                </div>



                <hr class="my-4">
                <div class="row">
                    <div class="col">
                        <label for="address_kakao" class="form-label">ë„ë¡œëª… ì£¼ì†Œ</label>
                        <input type="text" class="form-control" id="address_kakao" placeholder="ë„ë¡œëª… ì£¼ì†Œ" required>
                    </div>
                    <div class="col">
                        <label for="address_detail" class="form-label">ì§€ë²ˆ ì£¼ì†Œ</label>
                        <input type="text" class="form-control" id="address_detail" placeholder="ì§€ë²ˆ ì£¼ì†Œ" required>
                    </div>
                </div>



                <!--
                    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
                    <script>
                        window.onload = function(){
                            document.getElementById("address_kakao").addEventListener("click", function(){ //ì£¼ì†Œì…ë ¥ì¹¸ì„ í´ë¦­í•˜ë©´
                                //ì¹´ì¹´ì˜¤ ì§€ë„ ë°œìƒ
                                new daum.Postcode({
                                    oncomplete: function(data) { //ì„ íƒì‹œ ì…ë ¥ê°’ ì„¸íŒ…
                                        document.getElementById("address_kakao").value = data.address; // ì£¼ì†Œ ë„£ê¸°
                                        document.querySelector("input[name=address_detail]").focus(); //ìƒì„¸ì…ë ¥ í¬ì»¤ì‹±
                                    }
                                }).open();
                            });
                        }
                    </script>
                -->
                    <hr class="my-4">

                <div class="d-flex justify-content-center">
                <label class="form-label" id="rangeHuman">ì¸ì›ìˆ˜</label>
                </div>
                <div class="d-flex justify-content-center">
                    <input type="range" class="form-range" min="1" max="99" step="1" id="myRange">
                </div>

                <script>
                    var slider = document.getElementById("myRange");
                    var output = document.getElementById("rangeHuman");
                    output.innerHTML = slider.value;

                    slider.oninput = function() {
                        output.innerHTML = this.value;
                    }
                </script>

                    <hr class="my-4">


                <button class="w-100 btn btn-primary btn-lg" id="writeBtn" onclick="crewMake()">ğŸ’ªëª¨ì„ ì‹œì‘í•˜ê¸°</button>
                <br>
                <button class="w-100 btn btn-primary btn-lg" id="backBtn">ì¡°ê¸ˆ ë” ë‘˜ëŸ¬ë³´ê¸°</button>
            </div>
        </div>
    </main>

</div>

<script>
    document.getElementById('backBtn').addEventListener('click',back);
    function back(){
        location.href="/view/v1/crews";
    }

    async function chatRoomMake(crewId){
        let response = await fetch("/api/v1/room", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                crewId: crewId,
                name: document.getElementById("title").value
            })
        })
        console.log(response);
        if(response.ok){
            let json = await response.json()
            console.log(json);
            alert("ì±„íŒ…ë“±ë¡");
        }else{
            let json = await response.text();
            console.log(json);
            alert("ì‹¤íŒ¨");
        }
    }

   async function crewMake() {
       let choose = document.querySelector('input[type=radio][name=sportradio]:checked').value;

       if(choose === null){
           console.log("error not choose");
           return;
       }
       console.log("start");
        let response = await fetch("/api/v1/crews", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                strict: document.getElementById("address_detail").value,
                roadName: document.getElementById("address_kakao").value,
                crewLimit: document.getElementById("myRange").value,
                content: document.getElementById("content").value,
                title: document.getElementById("title").value,
                datepick: document.getElementById("datepicker").value,
                timepick: document.getElementById("timepicker").value,
                imagePath: document.getElementById("imagePath").value,
                chooseSport: choose
            })

        })
        console.log(response);
        if(response.ok){
            let json = await response.json()
            console.log(json);
            alert("ëª¨ì„ë“±ë¡ì„±ê³µ!");
            let crewId = json.result.crewId;
            chatRoomMake(crewId);
            location.href="/view/v1/crews";
        }else{
            let json = await response.text();
            console.log(json);
        }
   }


    function profileUpload() {

        let uuidString = self.crypto.randomUUID();

        const ACCESS_KEY = 'AKIA44KXB4KHWH22K4HD';
        const SECRET_ACCESS_KEY = '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';
        const REGION = 'ap-northeast-2';
        const BUCKET_NAME = 'poco-bucket-2';
        const BUCKET_DIRECTORY = '/crewimages';
        const S3_BUCKET = BUCKET_NAME + BUCKET_DIRECTORY;

        // AWS ACCESS KEYë¥¼ ì„¸íŒ…í•©ë‹ˆë‹¤.
        AWS.config.update({
            accessKeyId: ACCESS_KEY,
            secretAccessKey: SECRET_ACCESS_KEY
        });

        // ë²„í‚·ì— ë§ëŠ” ì´ë¦„ê³¼ ë¦¬ì „ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        const myBucket = new AWS.S3({
            params: { Bucket: S3_BUCKET},
            region: REGION,
        });



        let files = document.getElementById('imageFile').files;
        let file = files[0];

        let fileName = uuidString + '-' + file.name.replace(' ', '');


        const params = {
            ACL: 'public-read',
            Body: file,
            Bucket: S3_BUCKET,
            Key: fileName
        };


        myBucket.putObject(params)
            .on('httpUploadProgress', (evt) => {
                alert("SUCCESS");
                console.log(fileName);
                $('#imagePath').val(fileName);
            })
            .send((err) => {
                if (err) console.log(err)
            })

    }



</script>



</body>
</html>