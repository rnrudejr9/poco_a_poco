<!doctype html>
<!--<link href="/css/main.css" rel="stylesheet">-->

<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/fragment :: head">
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

</head>
<style>

    /*타이핑*/
    .typeText::after {
        content: "|";
        animation:  blink 1s step-end infinite;
    }
    @keyframes blink {
        0% {
            opacity:1;
        }
        49% {
            opacity:1;
        }
        50% {
            opacity:0;
        }
        100% {
            opacity:0;
        }
    }


    /*긴 문자 처리*/
    .text-strict {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 50%;
    }
    .text-strict2 {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 30%;
    }
    .card-tile {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #333838;
        width: 90%;
    }
    .card-text {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #323334;
        width: 100%;
    }
    .card-body {
        background-color: rgba(248, 253, 253, 0.98);
    }

    /*크루 모집글 박스*/
    .crewBoxParent {
        width:100%;
        margin:0px auto;
        padding:0px;
        overflow: auto;

        /*background-color: #585858;*/
        /*border:3px solid red;*/

    }
    .crewBox {
        background-color: rgba(248, 253, 253, 0.98);
        border-radius: 20px;
        box-shadow: 0 8px 14px rgba(82, 216, 254, 0.71),
        0 5px 5px rgba(0,0,0,0.22);
        position: center;
        overflow: hidden;
        width: 31.3%;
        border: rgba(63, 122, 254, 0.7);
        padding: 0.7%;
        margin: 1%;
    }
    /*크루 사진*/
    .img-thumbnail{
        width: 100%;
        height: 225px;
        border-radius: 20px;
        margin-bottom: 7px;
    }

    /*운동 선택 무빙 효과*/
    .btn-jittery {
        animation: jittery 8s infinite;
    }
    @keyframes jittery {
        5%,
        50% {
            transform: scale(1);
        }

        10% {
            transform: scale(0.9);
        }

        15% {
            transform: scale(1.15);
        }

        20% {
            transform: scale(1.15) rotate(-5deg);
        }

        25% {
            transform: scale(1.15) rotate(5deg);
        }

        30% {
            transform: scale(1.15) rotate(-3deg);
        }

        35% {
            transform: scale(1.15) rotate(2deg);
        }

        40% {
            transform: scale(1.15) rotate(0);
        }
    }

    /*운동선택 효과*/
    .btn.cyan{
        background-color: #7fccde;
        box-shadow:0px 4px 0px #73B9C9;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }
    .btn-gradient.cyan {
        background: rgba(27,188,194,1);
        background: -webkit-gradient(linear, 0 0, 0 100%, from(rgba(27,188,194,1)), to(rgba(24,163,168,1)));
        background: -webkit-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: -moz-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: -o-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#1bbcc2', endColorstr='#18a3a8', GradientType=0);
    }

    /*모임등록 효과*/
    .btn.blue{
        background: #6698cb;
        box-shadow:0px 4px 0px  #7fb1bf;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }
    .btn.blue {box-shadow: 0px 4px #74a3b0;}
    .btn.blue:active {box-shadow: 0 0 #74a3b0; background-color: #709CA8;}
    .btn-gradient.blue {
        background: rgba(102, 152, 203, 1);
        background: -moz-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -webkit-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -o-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -ms-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: linear-gradient(to bottom, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6698cb', endColorstr='#5c8ab8', GradientType=0);
    }

    .participation{
        color: black;
    }
</style>



<body>
<!-- 네비바-->
<header th:replace="fragments/fragment :: nav"></header>

<main>
    <!-- 소개-->
    <section class="py-5 text-center">
        <div class="row py-lg-5">
            <div class="col-lg-6 col-md-8 mx-auto">
                <div  class="">
                    <h1 style="display:inline;">운동</h1>
                    <h1 style="display:inline;" class="typeText"></h1>
                </div>
                <p class="lead text-muted">
                    <br>
                    운동 메이트로 함께 운동하고, <br>
                    동네 이웃과 운동 메이트가 되어 보세요.
                </p>

            </div>
        </div>
    </section>

    <div class="album py-5 bg-light">
        <div class="container">

            <!-- 운동 종목 데이터 확인-->
            <!--            <label th:text="|userSportsList : ${userSportsList}|"></label><br>-->
            <!--            <label th:text="|sportRequest.getSportsList() : ${sportRequest.getSportsList()}|"></label>-->

            <!-- 운동 체크-->
            <div class="row row-cols-1 row-cols-sm-4 row-cols-md-5 g-col-4">
                <div class="d-grid gap-2 d-md-block">
                    <button class="btn btn-gradient cyan btn-jittery" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        <strong>Like 운동</strong>
                    </button>
                </div>
                <div></div>
                <div></div>
                <div></div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-gradient blue" type="button" onclick="location.href='/view/v1/crews/write'">
                        <strong>+ 모임 등록</strong>
                    </button>
                </div>
            </div>

            <div class="collapse" id="collapseExample">
                <div class="card card-body">
                    <form th:action method="get" th:object="${sportRequest}" id="btn-sports">
                        <small class="text-muted" type="hidden" th:field="*{loginStatus}" th:value="${sportRequest.loginStatus}"></small>
                        <div class="grid text-center">
                            <div class="row row-cols-1 row-cols-sm-4 row-cols-md-5 g-4">
                                <label class="btn btn-outline-secondary" th:each="sport : ${sportEnums}">
                                    <input type="checkbox"
                                           onclick="count_check(this)"
                                           name="chk"
                                           th:field="*{sportsList}"
                                           th:value="${sport}"
                                           th:text="${sport.getValue()}">
                                </label>
                            </div>
                            <button class="btn btn-primary" type="submit" >조회 버튼</button>
                            <button class="btn btn-primary" type="button" onclick="location.href='/view/v1/crews'">
                                My운동종목
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 앨범-->
            <div class="crewBoxParent row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 ">
                <div class="col crewBox" th:each="crew : ${crewList}">
                    <a class="link-light" th:href="@{/view/v1/crews/{crewId}(crewId = ${crew.id},
                                                                               page = (${nowPage} - 1) * 9 + ${crewStat.index},
                                                                               loginStatus = ${sportRequest.loginStatus},
                                                                               strict = ${sportRequest.getStrict()},
                                                                               sportsList = ${sportRequest.getSportsList()}
                                                                               )}">
                    <small class="text-muted" type="hidden" th:value="${crewStat.index}"></small>
                        <img src="" class="img-thumbnail" id="main-image">
                        <input type="hidden" name="img-key" th:value="${crew.imagePath}">
                        <div class="card-body">
                            <div class="test">
                                <h3 class="card-tile" th:text="${crew.title}">제목</h3>
                                <p class="card-text" th:text="${crew.content}">내용</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted text-strict" th:text="${crew.strict}">지역</small>
                                <small class="text-muted text-strict2" ></small>
                                <small class="participation text-muted" th:id="${crew.id}">참여
                                    <script type="text/javascript" th:inline="javascript">
                                        async function findPart(crewId) {
                                            var crewId = crewId;
                                            let response = await fetch("/api/v1/part/find/" + crewId, {
                                                method: "GET",
                                                headers: {
                                                    "Content-Type": "application/json"
                                                },
                                                credentials: "include",
                                            })
                                            console.log("end");
                                            if(response.ok){
                                                var json = await response.json();
                                                console.log(json);
                                                var str = "<b>" + json.result.now + "</b>";
                                                document.getElementById(crewId).innerHTML = str;
                                            }else{
                                                var json = await response.json();
                                                console.log(json);
                                            }
                                        }
                                        findPart([[${crew.id}]])
                                    </script>
                                </small>
                                <small class="text-muted" > / [(${crew.crewLimit})] 명</small>
<!--                                <div class="btn-group">-->
<!--                                    <button type="button" class="btn btn-secondary">-->
<!--                                        <a class="link-light" th:href="@{/view/v1/crews/{crewId}(crewId = ${crew.id},-->
<!--                                                                               page = (${nowPage} - 1) * 9 + ${crewStat.index},-->
<!--                                                                               loginStatus = ${sportRequest.loginStatus},-->
<!--                                                                               strict = ${sportRequest.getStrict()},-->
<!--                                                                               sportsList = ${sportRequest.getSportsList()}-->
<!--                                                                               )}">상세보기</a>-->
<!--                                    </button>-->
<!--                                </div>-->

                            </div>
                        </div>
                    </a>
                    </div>


                </div>
            </div>

            <!-- 하단 페이징-->
            <div class="py-3 my-4">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${1 == nowPage} ? 'disabled'">
                            <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage - 2},
                                                                           strict=${sportRequest.getStrict()},
                                                                           loginStatus = ${sportRequest.loginStatus},
                                                                           sportsList=${sportRequest.getSportsList()})}">Previous</a>
                        </li>
                        <th:block th:each="page : ${#numbers.sequence(startNumPage, endNumPage)}">
                            <li class="page-item" th:if="${page != nowPage}"><a class="page-link"
                                                                                th:href="@{/view/v1/crews(
                                                                                            page = ${page - 1},
                                                                                            loginStatus = ${sportRequest.loginStatus},
                                                                                            strict=${sportRequest.getStrict()},
                                                                                            sportsList=${sportRequest.getSportsList()}
                                                                                            )}" th:text="${page}">1</a></li>

                            <li class="page-item" th:if="${page == nowPage}"><strong class="page-link" th:text="${page}" style="color: red"></strong></li>
                        </th:block>
                        <li class="page-item" th:classappend="${lastPage == nowPage} ? 'disabled'">
                            <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage},
                                                                           strict=${sportRequest.getStrict()},
                                                                           loginStatus = ${sportRequest.loginStatus},
                                                                           sportsList=${sportRequest.getSportsList()})}">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</main>

<footer th:replace="fragments/fragment :: footer"></footer>

<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

<script>


</script>

<script type="text/javascript" th:inline="javascript">

    window.onload = async function profileGet() {

        let uuidString = self.crypto.randomUUID();

        const ACCESS_KEY = 'AKIA44KXB4KHWH22K4HD';
        const SECRET_ACCESS_KEY = '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';
        const REGION = 'ap-northeast-2';
        const BUCKET_NAME = 'poco-bucket-2';
        const BUCKET_DIRECTORY = '/crewimages';
        const S3_BUCKET = BUCKET_NAME + BUCKET_DIRECTORY;

        // AWS ACCESS KEY를 세팅합니다.

        AWS.config.update({
            accessKeyId: ACCESS_KEY,
            secretAccessKey: SECRET_ACCESS_KEY
        });

        var s3 = new AWS.S3({
            region: REGION
        });

        var imgKey = $('input[name=img-key]').val();

        if(!imgKey){
            imgKey = '4f9e2be2-7e04-4aa8-bde0-ac2c4df64fcd-blank-profile-picture-g7d902ce67_1280.png'
        }

        // 'e44091b4-4c0a-439c-98b1-086773f65f85-lighthouse.png'



        const params = {
            Bucket: S3_BUCKET,
            Key: imgKey
        };

        var url = s3.getSignedUrl(
            "getObject", params
        );

        // const img1 = document.getElementById('left-image');
        // img1.src = url;

        const img2 = document.getElementById('main-image');
        img2.src = url;

        console.log(url);



    }

    // 타이핑 효과
    var typeText = document.querySelector(".typeText")
    var textToBeTyped = "운동 메이트"
    var textToBeTypedArr = ["메", "\0메이트!"]
    var index = 0, isAdding = true, textToBeTypedIndex = 0

    function playAnim() {
        setTimeout(function () {
            // set the text of typeText to a substring of the text to be typed using index.
            typeText.innerText = textToBeTypedArr[textToBeTypedIndex].slice(0, index)
            if (isAdding) {
                // adding text
                if (index > textToBeTypedArr[textToBeTypedIndex].length) {
                    // no more text to add
                    isAdding = false
                    //break: wait 2s before playing again
                    setTimeout(function () {
                        playAnim()
                    }, 2500)
                    return
                } else {
                    // increment index by 1
                    index++
                }
            } else {
                // removing text
                if (index === 0) {
                    // no more text to remove
                    isAdding = true
                    //switch to next text in text array
                    textToBeTypedIndex = (textToBeTypedIndex + 1) % textToBeTypedArr.length
                } else {
                    // decrement index by 1
                    index--
                }
            }
            // call itself
            playAnim()
        }, isAdding ? 200 : 150)
    }
    // start animation
    playAnim()

</script>
<script>
    // GetMapping에서 데이터 조회 완료 후 url로 파라미터 삭제
    history.replaceState({}, null, location.pathname);

    // 운동 종목 체크박스 3개 초과 시 알람
    function count_check(obj) {

        var chkBox = document.getElementById("btn-sports");
        var chkCnt = 0;

        for (var i = 0; i < chkBox.length; i++) {
            if (chkBox[i].checked) {
                chkCnt++;
            }
        }
        if (chkCnt > 3) {
            alert("최대 3개 체크 가능합니다.");
            obj.checked = false;
            return false;
        }
    }


</script>

</body>
</html>
