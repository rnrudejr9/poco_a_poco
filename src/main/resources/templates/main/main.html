<!doctype html>
<!--<link href="/css/main.css" rel="stylesheet">-->

<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/fragment :: head">
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

</head>
<style>

    /*íƒ€ì´í•‘*/
    .typeText::after {
        content: "|";
        animation:  blink 1s step-end infinite;
    }
    @keyframes blink {
        0% {
            opacity:1;
        }
        49% {
            opacity:1;
        }
        50% {
            opacity:0;
        }
        100% {
            opacity:0;
        }
    }


    /*ê¸´ ë¬¸ì ì²˜ë¦¬*/
    .text-strict {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 50%;
    }
    .text-strict2 {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 30%;
    }
    .card-tile {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #333838;
        width: 90%;
    }
    .card-text {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #323334;
        width: 100%;
    }
    .card-body {
        background-color: rgba(248, 253, 253, 0.98);
    }

    /*í¬ë£¨ ëª¨ì§‘ê¸€ ë°•ìŠ¤*/
    .crewBoxParent {
        width:100%;
        margin:0px auto;
        padding:0px;
        overflow: auto;

        /*background-color: #585858;*/
        /*border:3px solid red;*/

    }
    .crewBox {
        background-color: rgba(248, 253, 253, 0.98);
        border-radius: 20px;
        box-shadow: 0 8px 14px rgba(82, 216, 254, 0.71),
        0 5px 5px rgba(0,0,0,0.22);
        position: center;
        overflow: auto;
        width: 31.3%;
        border: rgba(63, 122, 254, 0.7);
        padding: 0.7%;
        margin: 1%;
    }
    /*í¬ë£¨ ì‚¬ì§„*/
    .img-thumbnail{
        width: 100%;
        height: 225px;
        border-radius: 20px;
        margin-bottom: 7px;
    }

    /*ìš´ë™ ì„ íƒ ë¬´ë¹™ íš¨ê³¼*/
    .btn-jittery {
        animation: jittery 8s infinite;
    }
    @keyframes jittery {
        5%,
        50% {
            transform: scale(1);
        }

        10% {
            transform: scale(0.9);
        }

        15% {
            transform: scale(1.15);
        }

        20% {
            transform: scale(1.15) rotate(-5deg);
        }

        25% {
            transform: scale(1.15) rotate(5deg);
        }

        30% {
            transform: scale(1.15) rotate(-3deg);
        }

        35% {
            transform: scale(1.15) rotate(2deg);
        }

        40% {
            transform: scale(1.15) rotate(0);
        }
    }

    /*ìš´ë™ì„ íƒ íš¨ê³¼*/
    .btn.cyan{
        background-color: #7fccde;
        box-shadow:0px 4px 0px #73B9C9;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }
    .btn-gradient.cyan {
        background: rgba(27,188,194,1);
        background: -webkit-gradient(linear, 0 0, 0 100%, from(rgba(27,188,194,1)), to(rgba(24,163,168,1)));
        background: -webkit-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: -moz-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: -o-linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        background: linear-gradient(rgba(27,188,194,1) 0%, rgba(24,163,168,1) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#1bbcc2', endColorstr='#18a3a8', GradientType=0);
    }

    /*ëª¨ì„ë“±ë¡ íš¨ê³¼*/
    .btn.blue{
        background: #6698cb;
        box-shadow:0px 4px 0px  #7fb1bf;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }
    .btn.blue {box-shadow: 0px 4px #74a3b0;}
    .btn.blue:active {box-shadow: 0 0 #74a3b0; background-color: #709CA8;}
    .btn-gradient.blue {
        background: rgba(102, 152, 203, 1);
        background: -moz-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -webkit-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -o-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: -ms-linear-gradient(top, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        background: linear-gradient(to bottom, rgba(102, 152, 203, 1) 0%, rgba(92, 138, 184, 1) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6698cb', endColorstr='#5c8ab8', GradientType=0);
    }

    .participation{
        color: black;
    }

    /*ê²€ìƒ‰ë°”*/
    .btnBar{
        width: 100%;
        /*background-color: #585858;*/
        /*border:3px solid red;*/
    }
    .searchBar{
        width: 100%;
        position: center;
    }
    .searchBar2{
        width: 80%;
        margin-left: 10%;
        margin-top: 7%;
        position: center;
        border-radius: 5px;
        box-shadow: 0 4px 10px rgba(1, 119, 152, 0.98),
        0 5px 5px rgba(0,0,0,0.22);
        border: rgba(1, 27, 86, 0.94);
    }

    btn3{
        width: 30%;
        background-color: rgb(101, 68, 76);
        border:3px solid rgba(46, 223, 255, 0.9);
    }

    /*ì²´í¬ë°•ìŠ¤*/
    .collapse{
        width:100%;
        margin:0px auto;
        padding:0px;
        overflow: auto;
    }
    .collapse-body{
        width: 98%;
        position: center;
        margin: 2%;
        padding: 2%;
        border-radius: 10px;
    }
    .checkBox-sport {
        box-shadow: 0 4px 7px rgba(82, 216, 254, 0.71),
        0 5px 5px rgba(0,0,0,0.22);
        color: black;
    }

    /*ì²´í¬ë°•ìŠ¤ ë²„íŠ¼*/
    .checkBox-btn{
        margin-top: 2%;
        width:100%;
        padding:0px;
        overflow: auto;
    }




</style>



<body>
<!-- ë„¤ë¹„ë°”-->
<header th:replace="fragments/fragment :: nav"></header>

<script th:inline="javascript" type="text/javascript" src="/js/main.js"></script>

<main>
    <!-- ì†Œê°œ-->
    <section class="py-5 text-center container ">
<!--    <section class="py-5 text-center">-->
        <div class="row py-lg-5">
            <div class="col-lg-6 col-md-8 mx-auto">
                <div  class="">
                    <h1 style="display:inline;">ìš´ë™</h1>
                    <h1 style="display:inline;" class="typeText"></h1>
                </div>
                <p class="lead text-muted">
                    <br>
                    ìš´ë™ ë©”ì´íŠ¸ë¡œ í•¨ê»˜ ìš´ë™í•˜ê³ , <br>
                    ë™ë„¤ ì´ì›ƒê³¼ ìš´ë™ ë©”ì´íŠ¸ê°€ ë˜ì–´ ë³´ì„¸ìš”.
                </p>
                <div class="searchBar">
                    <form class="row searchBar2" role="search" action="/view/v1/crews" method="get" name="findAllCrewWithStrict" >
                        <input type="search" name="strict" class="form-control form-control-dark text-bg-blue"
                               placeholder="ê´€ì‹¬ ìˆëŠ” ì§€ì—­ì„ ê²€ìƒ‰í•´ ë³´ì„¸ìš”" aria-label="Search">
                    </form>
                </div>

            </div>
        </div>
    </section>

    <div class="album py-5 bg-light">
        <div class="container">

            <!-- ìš´ë™ ì¢…ëª© ë°ì´í„° í™•ì¸-->
            <!--            <label th:text="|userSportsList : ${userSportsList}|"></label><br>-->
            <!--            <label th:text="|sportRequest.getSportsList() : ${sportRequest.getSportsList()}|"></label>-->

            <!-- ìš´ë™ ì²´í¬-->
            <div class="btnBar row row-cols-1 row-cols-sm-4 row-cols-md-5 g-col-4">
                <div class="btn3 d-grid gap-2 d-md-block">
                    <button class="btn btn-gradient cyan btn-jittery" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        <strong>Like ìš´ë™</strong>
                    </button>
                </div>
                <div></div>
                <body>
                <div id="messages"></div>
                </body>
                <div>
                    <p>
                    <div id="randomCnt" th:text="${randomCnt}"></div>
                    </p>
                </div>
                <div class="btn3 d-grid gap-3 d-md-flex justify-content-md-end">
                    <button class="btn btn-outline-danger" type="button" onclick="randomMatch()">
                        + ëœë¤ ë§¤ì¹­ğŸ”¥
                    </button>
                    <button class="btn btn-gradient blue" type="button" onclick="location.href='/view/v1/crews/write'">
                        <strong>+ ëª¨ì„ ë“±ë¡</strong>
                    </button>
                </div>
            </div>

            <div class="collapse" id="collapseExample">
                <div class="card card-body collapse-body">
                    <form th:action method="get" th:object="${sportRequest}" id="btn-sports">
                        <small class="text-muted" type="hidden" th:field="*{loginStatus}" th:value="${sportRequest.loginStatus}"></small>
                        <div class="grid text-center">
                            <div class="row row-cols-1 row-cols-sm-4 row-cols-md-5 g-4">
                                    <label class="checkBox-sport btn btn-outline-info" th:each="sport : ${sportEnums}">
                                    <input type="checkbox"
                                           onclick="count_check(this)"
                                           name="chk"
                                           th:field="*{sportsList}"
                                           th:value="${sport}"
                                           th:text="${sport.getValue()}">
                                </label>
                            </div>
                            <div class="checkBox-btn btn3">
                                <button class="btn btn-gradient blue" type="submit" ><strong>ì¡°íšŒ ë²„íŠ¼</strong></button>
                                <button class="btn btn-gradient blue" type="button" onclick="location.href='/view/v1/crews'">
                                    <strong>Myìš´ë™ì¢…ëª©</strong>
                                </button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>

            <!-- ì•¨ë²”-->
            <div class="crewBoxParent row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 ">
                <div class="col crewBox" th:each="crew : ${crewList}">
                    <a class="link-light" th:href="@{/view/v1/crews/{crewId}(crewId = ${crew.id},
                                                                               page = (${nowPage} - 1) * 9 + ${crewStat.index},
                                                                               loginStatus = ${sportRequest.loginStatus},
                                                                               strict = ${sportRequest.getStrict()},
                                                                               sportsList = ${sportRequest.getSportsList()}
                                                                               )}">
                    <small class="text-muted" type="hidden" th:value="${crewStat.index}"></small>
                        <img src="" class="img-thumbnail" id="main-image">
                        <input type="hidden" name="img-key" th:value="${crew.imagePath}">
                        <div class="card-body">
                            <div class="test">
                                <h3 class="card-tile" th:text="${crew.title}">ì œëª©</h3>
                                <p class="card-text" th:text="${crew.content}">ë‚´ìš©</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted text-strict" th:text="${crew.strict}">ì§€ì—­</small>
                                <small class="text-muted text-strict2" ></small>
                                <small class="participation text-muted" th:id="${crew.id}">
                                    <script th:inline="javascript">
                                        findPart([[${crew.id}]]);
                                    </script>
                                </small>
                                <small class="text-muted" th:text="${crew.crewLimit} + ëª…">ì¸ì›</small>
                            </div>
                        </div>
                    </a>
                    </div>


            </div>
        </div>

            <!-- í•˜ë‹¨ í˜ì´ì§•-->
            <div class="py-3 my-4">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${1 == nowPage} ? 'disabled'">
                            <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage - 2},
                                                                           strict=${sportRequest.getStrict()},
                                                                           loginStatus = ${sportRequest.loginStatus},
                                                                           sportsList=${sportRequest.getSportsList()})}">Previous</a>
                        </li>
                        <th:block th:each="page : ${#numbers.sequence(startNumPage, endNumPage)}">
                            <li class="page-item" th:if="${page != nowPage}"><a class="page-link"
                                                                                th:href="@{/view/v1/crews(
                                                                                            page = ${page - 1},
                                                                                            loginStatus = ${sportRequest.loginStatus},
                                                                                            strict=${sportRequest.getStrict()},
                                                                                            sportsList=${sportRequest.getSportsList()}
                                                                                            )}" th:text="${page}">1</a></li>

                            <li class="page-item" th:if="${page == nowPage}"><strong class="page-link" th:text="${page}" style="color: red"></strong></li>
                        </th:block>
                        <li class="page-item" th:classappend="${lastPage == nowPage} ? 'disabled'">
                            <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage},
                                                                           strict=${sportRequest.getStrict()},
                                                                           loginStatus = ${sportRequest.loginStatus},
                                                                           sportsList=${sportRequest.getSportsList()})}">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</main>

<footer th:replace="fragments/fragment :: footer"></footer>

<!-- JavaScript Bundle with Popper -->
<script type="text/javascript" src="/js/random.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>


<script type="text/javascript" th:inline="javascript">

    window.onload = async function profileGet() {

        let uuidString = self.crypto.randomUUID();

        const ACCESS_KEY = 'AKIA44KXB4KHWH22K4HD';
        const SECRET_ACCESS_KEY = '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';
        const REGION = 'ap-northeast-2';
        const BUCKET_NAME = 'poco-bucket-2';
        const BUCKET_DIRECTORY = '/crewimages';
        const S3_BUCKET = BUCKET_NAME + BUCKET_DIRECTORY;

        // AWS ACCESS KEYë¥¼ ì„¸íŒ…í•©ë‹ˆë‹¤.

        AWS.config.update({
            accessKeyId: ACCESS_KEY,
            secretAccessKey: SECRET_ACCESS_KEY
        });

        var s3 = new AWS.S3({
            region: REGION
        });

        var imgKey = $('input[name=img-key]').val();

        if(!imgKey){
            imgKey = '4f9e2be2-7e04-4aa8-bde0-ac2c4df64fcd-blank-profile-picture-g7d902ce67_1280.png'
        }

        // 'e44091b4-4c0a-439c-98b1-086773f65f85-lighthouse.png'



        const params = {
            Bucket: S3_BUCKET,
            Key: imgKey
        };

        var url = s3.getSignedUrl(
            "getObject", params
        );

        // const img1 = document.getElementById('left-image');
        // img1.src = url;

        const img2 = document.getElementById('main-image');
        img2.src = url;

        console.log(url);
    }

    // íƒ€ì´í•‘ íš¨ê³¼
    var typeText = document.querySelector(".typeText")
    var textToBeTyped = "ìš´ë™ ë©”ì´íŠ¸"
    var textToBeTypedArr = ["ë©”", "\0ë©”ì´íŠ¸!"]
    var index = 0, isAdding = true, textToBeTypedIndex = 0

    function playAnim() {
        setTimeout(function () {
            // set the text of typeText to a substring of the text to be typed using index.
            typeText.innerText = textToBeTypedArr[textToBeTypedIndex].slice(0, index)
            if (isAdding) {
                // adding text
                if (index > textToBeTypedArr[textToBeTypedIndex].length) {
                    // no more text to add
                    isAdding = false
                    //break: wait 2s before playing again
                    setTimeout(function () {
                        playAnim()
                    }, 2500)
                    return
                } else {
                    // increment index by 1
                    index++
                }
            } else {
                // removing text
                if (index === 0) {
                    // no more text to remove
                    isAdding = true
                    //switch to next text in text array
                    textToBeTypedIndex = (textToBeTypedIndex + 1) % textToBeTypedArr.length
                } else {
                    // decrement index by 1
                    index--
                }
            }
            // call itself
            playAnim()
        }, isAdding ? 200 : 150)
    }
    // start animation
    playAnim()

    // GetMappingì—ì„œ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ í›„ urlë¡œ íŒŒë¼ë¯¸í„° ì‚­ì œ
    history.replaceState({}, null, location.pathname);

    // ìš´ë™ ì¢…ëª© ì²´í¬ë°•ìŠ¤ 3ê°œ ì´ˆê³¼ ì‹œ ì•ŒëŒ
    function count_check(obj) {

        var chkBox = document.getElementById("btn-sports");
        var chkCnt = 0;

        for (var i = 0; i < chkBox.length; i++) {
            if (chkBox[i].checked) {
                chkCnt++;
            }
        }
        if (chkCnt > 3) {
            alert("ìµœëŒ€ 3ê°œ ì²´í¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            obj.checked = false;
            return false;
        }
    }
</script>

</body>
</html>
