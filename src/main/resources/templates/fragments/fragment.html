<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.104.2">
    <title>Album example Â· Bootstrap v5.2</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        .card-body {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

    </style>


</head>
<body>
<!-- ë„¤ë¹„ë°”-->
<header class="p-3 text-bg-dark" th:fragment="nav">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
                    <use xlink:href="#bootstrap"/>
                </svg>
            </a>
            <!-- ë©”ë‰´-->
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li><a href="#" class="nav-link px-2 text-white"><h4>ğŸ’ªìš´ë™ë©”&emsp;&emsp;</h4></a></li>
                <li><a href="/view/v1/crews/" class="nav-link px-2 text-white"><h5>ëª¨ì§‘ê¸€&emsp;&emsp;</h5></a></li>
                <li><a href="/view/v1/alarm/" sec:authorize="isAuthenticated()" th:href="@{/view/v1/alarm}" class="nav-link px-2 text-white"><h5>ì•Œë¦¼&emsp;&emsp;</h5>
                </a></li>
                <li><a href="/view/v1/users/profile/my" sec:authorize="isAuthenticated()" th:href="@{/view/v1/users/profile/my}"
                       class="nav-link px-2 text-white"><h5>Myí”„ë¡œí•„&emsp;&emsp;</h5></a></li>

                <li><a href="/view/v1/rooms" sec:authorize="isAuthenticated()" class="nav-link px-2 text-white">CHAT!</a></li>
            </ul>

            <!-- ê²€ìƒ‰-->
            <form class="col-3 col-lg-3 mb-4 mb-lg-0 me-lg-3" role="search" action="/view/v1/crews" method="get"
                  name="findAllCrewWithStrict" >
                <input type="search" name="strict" class="form-control form-control-dark text-bg-dark"
                       placeholder="ê´€ì‹¬ ìˆëŠ” ì§€ì—­ì„ ê²€ìƒ‰í•´ ë³´ì„¸ìš”" aria-label="Search">

            </form>

            <!-- ë¡œê·¸ì¸&íšŒì›ê°€ì…-->
            <div class="text-end">
                <button type="button" class="btn btn-outline-light me-2" sec:authorize="!isAuthenticated()"
                        onclick="location.href='/view/v1/start'">Login
                </button>
                <button type="button" class="btn btn-warning" sec:authorize="!isAuthenticated()"
                        onclick="location.href='/view/v1/start'">Sign-up
                </button>
                <span class="text-white" sec:authorize="isAuthenticated()" sec:authentication="name" id="myName">ì‚¬ìš©ì</span>
                <span class="text-white" sec:authorize="isAuthenticated()" >ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤âœ¨</span>
                <a type="button" class="btn btn-warning" th:href="@{/view/v1/logout}" sec:authorize="isAuthenticated()">Logout</a>
            </div>


        </div>
    </div>
</header>

<footer class="py-3 my-4" th:fragment="footer">
    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
    </ul>
    <p class="text-center text-muted">Â© 2023 Company, Inc</p>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
</footer>


</body>


<script type="application/javascript" th:fragment="form-validation">
    (function () {
        'use strict';

        window.addEventListener('load', function () {
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            let forms = document.getElementsByClassName('needs-validation');

            // Loop over them and prevent submission
            Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        }, false)
    }())
</script>

<script type="application/javascript" th:inline="javascript" th:fragment="read-crew">
    const crewId = [[${crewId}]];
    const username = [[${#authentication.name}]];

    $(function() {
        getComment();
        getJoinMembers();
    });

    function confirmDelete() {
        if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            $("#form").submit();
        }
        return false;
    }

    function replyPut() { // ëŒ€ëŒ“ê¸€ ìˆ˜ì •
        if (confirm("ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const commentId= $('#id').val();
            const crewId= $('#crewId').val();
            const content= $('#rcontent').val();
            $.ajax({
                type: "PUT",
                url: "/view/v1/crews/"+crewId+"/comments/"+commentId,
                data: JSON.stringify({"crewCommentId": crewId, "comment": content, "id": commentId}),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if(data == "articleCommentUpdating Success"){
                        alert('ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        location.reload();
                    }
                },
                error: function (status) {
                    status.responseJSON.forEach(function () {
                        $('.'+id+'ucommentContentCheck').text(this.message);
                        $('.'+id+'ucommentContentCheck').css('display', 'block');
                    } )
                }
            });
        }
    }

    function replyDelete(id) { // parentId
        if (confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const crewId= $('#crewIdComment').val();
            $.ajax({
                type: "DELETE",
                url: "/view/v1/crews/"+crewId+"/comments/"+id,
                data: JSON.stringify({"crewId": crewId, "id": id}),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if(data == "articleCommentDeleting Success"){
                        alert('ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        getComment();
                    }
                },
                error: function (request, status, error) {
                    alert(request.responseText);
                }
            })}}



    function commentUpdate (id) {
        if (confirm("ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const crewId = $('#crewIdComment').val();
            const ucommentContent = $('#'+id+'ucommentContent').val();
            $.ajax({
                type: "PUT",
                url: "/view/v1/crews/"+ crewId +"/comments/"+id,
                data: JSON.stringify({"crewId": crewId,
                    "comment": ucommentContent,
                }),
                contentType: "application/json; charset=utf-8",
                success: function(data) {
                    alert(data) ;
                    getComment();
                    $('.'+id+'ucommentContentCheck').text('');
                    $('.'+id+'ucommentContentCheck').css('display', 'none');
                },
                error: function (status) {
                    $(status.responseJSON).each(function(){
                        $('.'+id+'ucommentContentCheck').text(this.message);
                        $('.'+id+'ucommentContentCheck').css('display', 'block');
                    })
                }
            });
        }
    }

    $("#replyContent").blur(function(){
        const content = $("#replyContent").val();
        if(content.length > 100 || content.length<2){
            $(".replyContentCheck").text("ëŒ“ê¸€ì„ 2ì ì´ìƒ 100ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            $(".replyContentCheck").css("color", "red");
        }else {
            $(".replyContentCheck").text("");
            $(".replyContentCheck").css("color", "green");
        }
    });
    $("#ucommentContent").blur(function(){
        const content = $("#ucommentContent").val();
        if(content.length > 100 || content.length<2){
            $(".ucommentContentCheck").text("ëŒ“ê¸€ì„ 2ì ì´ìƒ 100ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            $(".ucommentContentCheck").css("color", "red");
        }else {
            $(".ucommentContentCheck").text("");
            $(".ucommentContentCheck").css("color", "green");
        }
    });
    // ë¶€ëª¨ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
    function getComment(){

        const principal = $("#principal").val(); // username
        $("#commentList").empty();  // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
        const crewId = document.getElementById("crewIdComment").value;
        $.ajax({
            type:"get",
            url:"/view/v1/crews/"+ crewId +"/comments",
            dataType:"json",
            success:function (data) {
                console.log(data);
                var html = " ";
                $(data).each(function(){ // comment
                    if(this.parent===true && this.deleted ===false){
                        html += "<ul class='list-group'>";
                        html += "<li class='list-group-item comments'>";
                        html += "<div class='comment' id='"+this.id+"comment'>";
                        html += "<a href='javascript:; class='userImg'>";
                        html += "<img src='https://user-images.githubusercontent.com/109712249/214782553-abb78e43-e1d8-4b35-bd7f-5127e852f398.png'  width='35px' height='35px' alt='userImg' class='userImg'>";
                        html += "</a>";
                        html += "<a href='javascript:;' class='writer' style='display:inline'>" + this.userName + "</a>";
                        html += "<div class='comment-info'>";
                        html += "<span class='comment4 date'>" + getFormatDate(new Date(this.createdAt)) + "</span>";
                        html += "<div class='comment-text' id='"+this.id+"content'> " + this.comment + "</div>";
                        html += "<div class='comment_etc'>";
                        html += "<div class='comment-info'>";
                        html += "<a href='javascript:;' class='btn btn-secondary btn-icon-split comment_delete' id='"+this.id+"getChildrenBtn' >";
                        html += "<button id='"+this.id+"getChildrenBtn' onclick='getChildrenComment("+this.id+")' class='btn btn'>ë‹µê¸€("+this.children.length+")</button>";
                        html += "</a>";
                        if(principal === this.userName) {
                            html += "<a href='javascript:;'>";
                            html += "<button type='button' onclick='commentDelete(" + this.id + ")' class='delete btn btn-outline-danger'  id='" + this.id + "deleteBtn'>ì‚­ì œ";
                            html += "</button>";
                            html += "</a>";
                        }if(principal === this.userName) {
                            html += "<a href='javascript:;'>";
                            html += "<button type='button'  onclick='commentUpdateForm(" + this.id + ")' class='btn btn-outline-secondary'  id='" + this.id + "updateBtn'>ìˆ˜ì •";
                            html += "</button>";
                            html += "</a>";
                        }
                        html += "</div>";
                        html += "</div>";
                        html += "</div>";
                        html += "</li>";
                        html += "<div id='"+this.id+"children' class='children'></div>";
                    }

                });
                html += "</ul>";

                $("#commentList").append(html);

            }
        });
    }
    function getFormatDate(date){
        var year = date.getFullYear();              //yyyy
        var month = (1 + date.getMonth());          //M
        month = month >= 10 ? month : '0' + month;  //month ë‘ìë¦¬ë¡œ ì €ì¥
        var day = date.getDate();                   //d
        day = day >= 10 ? day : '0' + day;          //day ë‘ìë¦¬ë¡œ ì €ì¥
        var hour = date.getHours();
        hour = hour >= 10 ? hour : '0' + hour;
        var minute = date.getMinutes();
        minute = minute >= 10 ? minute : '0' + minute;
        var second = date.getSeconds();
        second = second >= 10 ? second : '0' + second;

        return  year + '-' + month + '-' + day +' '+ hour +':'+ minute+':'+second//'-' ì¶”ê°€í•˜ì—¬ yyyy-mm-dd í˜•íƒœ ìƒì„± ê°€ëŠ¥
    }


    function commentDelete (id) {
        if (confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            $.ajax({
                type: "DELETE",
                url: "/view/v1/crews/"+crewId+"/comments/"+ id,
                contentType: "application/json; charset=utf-8",
                success: function () {
                    alert('ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    getComment();
                }
                ,
                error: function (xhr, status, error) {
                    alert(status.message);
                }
            });
        }
    }

    function commentUpdateForm(id){
        $("#"+id+"updateBtn").hide();
        $.ajax({
            type: "GET",
            url: "/view/v1/crews/"+crewId+"/comments/"+id,
            dataType: "json",
            success: function (data) {
                var html = "<div class='comment-update'>";
                html += "<div class='comment-update-form'>";
                html += "<textarea class='form-control' id='"+id+"ucommentContent' rows='3' placeholder='ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.'>"+data.comment+"</textarea>";
                html += "<div class='field-error "+id+"ucommentContentCheck'>";
                html += "</div>";
                html += "<div class='comment-update-btn'>";
                html += "<button type='button' class='btn btn-secondary'  onclick='commentUpdate("+data.id+")'>ìˆ˜ì •</button>";
                html += "<button type='button' class='btn btn-secondary' onclick='commentUpdateCancel("+data.id+")'>ì·¨ì†Œ</button>";
                html += "</div>";
                html += "</div>";
                html += "</div>";
                $("#"+data.id+"content").html(html);
            },
            error: function (xhr, status, error) {
                alert(status.message);
            }
        });
    }
    function commentUpdateCancel(id){
        $(".comment-update").html("");
        $("#"+id+"updateBtn").show();
        getComment();
    }

    function getChildrenComment(parentId){ //commentId(parent)
        const crewId = document.getElementById("crewIdComment").value;
        $("#"+parentId+"children").empty();
        $("#"+parentId+"children").show();
        const principal = $("#principal").val(); //userName
        $.ajax({
            type: "GET",
            url: "/view/v1/crews/"+crewId+"/comments/"+parentId+"/list",

            dataType: "json",
            success: function (data) { // children
                console.log(data);
                console.log("crewId:", crewId)
                console.log("parentId:",parentId)
                let html = "<ul class='list-group'>";
                if(principal!=null){
                    console.log("principleì˜ ê°’:",principal);
                    html +="<form>";
                    html += "<input type='text' class='form-control' id='"+parentId+"replyContent' placeholder='ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.'>";
                    html += "<div class='field-error rcommentContentCheck'>";
                    html += "</div>";
                    html += "<input type='hidden' id='crewId' value='"+data.crewId+"'>";
                    html += "<button type='button' class='btn btn-primary' onclick='replyCheck("+parentId+")'>ë‹µê¸€ë“±ë¡</button>";
                    html += "<div class='field-error "+data.id+"replyContentCheck'>";
                    html += "</div>";
                    html += "</form>";}
                $(data).each(function () {
                    if(this.deleted === false) {
                        console.log("successì‹œ ë°›ëŠ” data:"+this.id)
                        html += "<li class='list-group-item comments' style=\"background-color:#D9DCEB;\">";
                        html += "<div class='childrenComment' id='" + this.id + "comment'>";
                        html += "<a href='javascript:; class='comment-img'>";
                        html += "<img src='https://user-images.githubusercontent.com/109712249/214782553-abb78e43-e1d8-4b35-bd7f-5127e852f398.png'  width='35px' height='35px' alt='userImg' class='userImg'>";
                        html += "</a>";
                        html += "<div class='comment-info'>";
                        html += "<span class='comment4 date'>" + getFormatDate(new Date(this.createdAt)) + "</span>";
                        html += "<a href='javascript:;' class='writer' style='display:inline'>" + this.userName + "</a>";
                        html += "<div class='comment-text' id='" + this.id + "content'> " + this.comment + "</div>";
                        html += "<div class='comment_etc'>";
                        html += "<div class='comment-info'>";
                        if(principal === this.userName) {
                            html += "<a href='javascript:;'>";
                            html += "<button type='button' onclick='replyDelete(" + this.id + ")' class='delete btn btn-outline-danger'  id='" + this.id + "deleteBtn'>ì‚­ì œ";
                            html += "</button>";
                            html += "</a>";
                        }
                        if(principal === this.userName) {
                            html += "<a href='javascript:;'>";
                            html += "<button type='button'  onclick='commentUpdateForm(" + this.id + ")' class='btn btn-outline-secondary'  id='" + this.id + "updateBtn'>ìˆ˜ì •";
                            html += "</button>";
                        }
                        html += "</div>";
                        html += "</div>";
                        html += "</div>";
                        html += "</li>";
                    }});
                html += "</ul>";
                $("#"+parentId+"children").append(html);
                $("#"+parentId+"children").show();
                $("#"+parentId+"getChildrenBtn").html("ì ‘ê¸°");
                $("#"+parentId+"getChildrenBtn").attr("onclick","getChildrenCommentHide("+parentId+")");
            },
            error: function (xhr, status, error) {
                alert(status);
            }
        });

    }
    function getChildrenCommentHide(id){ // ëŒ“ê¸€ì˜ detail ê°€ì ¸ì˜¤ê¸°
        $("#"+id+"children").html("");
        $("#"+id+"children").hide();
        $.ajax({
            type: "GET",
            url: "/view/v1/crews/"+crewId+"/comments/"+id,
            dataType: "json",
            success: function (data) {
                $("#"+id+"getChildrenBtn").html("ë‹µê¸€("+data.children.length+")");
                $("#"+id+"getChildrenBtn").attr("onclick","getChildrenComment("+data.id+")");
            },
            error: function (xhr, status, error) {
                alert(status);
            }
        });

    }




    // ë²„íŠ¼ í´ë¦­ ì‹œ ì²«ë²ˆì§¸ ì‹¤í–‰ -> ë¶€ëª¨ ëŒ“ê¸€ ì‘ì„±
    function commentCheck() {
        const content = $("#commentContent").val();
        const crewId = $("#crewIdComment").val();
        $.ajax({
            type : "POST",
            url: '/view/v1/crews/'+ crewId +'/comments',
            async: false,
            data: JSON.stringify({
                "comment": content,
                "crewId": crewId,
                "parentId" : null
            }),
            contentType : "application/json; charset=utf-8",
            success: function(data) {
                alert("ë“±ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤.") ;
                getComment();
                $('.commentContentCheck').text('');
                $('.commentContentCheck').css('display', 'none');
            },
            error: function (status) {
                alert("ë¡œê·¸ì¸ í›„ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                $(status.responseJSON).each(function(){
                    $('.commentContentCheck').text(this.message);
                    $('.commentContentCheck').css('display', 'block');
                })
            }
        })
    }


    function replyCheck(parentId) { // ëŒ€ëŒ“ê¸€ ì‘ì„±
        var replyContent = $("#"+parentId+"replyContent").val();
        var crewId = $("#crewIdComment").val();
        $.ajax({
            type : "POST",
            url: '/view/v1/crews/'+ crewId +'/comments/'+parentId,
            data: JSON.stringify({
                "comment": replyContent,
                "parentId" : parentId
            }),
            contentType : "application/json; charset=utf-8",
            success: function(data) {
                alert(data);
                getChildrenComment((parentId))
            },
            error: function (status) {
                $(status.responseJSON).each(function(){
                    alert("ë¡œê·¸ì¸ í›„ ì‘ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.") ;
                    $('.'+parentId+'replyContentCheck').text(this.message);
                    $('.'+parentId+'replyContentCheck').css('display', 'block');
                })

            }
        }) ;
    }


    function likeBtn(crewId){
        $.ajax({
            type : "POST",
            url: '/view/v1/crews/'+crewId+'/like',
            success: function(data) {
                console.log(data);
                if(data.likeCheck == 1){
                    alert("ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì‹œê² ìŠµë‹ˆê¹Œ?")
                    $("#likeCnt").empty();
                    $("#likeCnt").append(data.count);
                }
                else if (data.likeCheck == 0){
                    alert("ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
                    $("#likeCnt").empty();
                    $("#likeCnt").append(data.count);

                }
            },
            error: function (request, status, error) {
                alert("ë¡œê·¸ì¸ í›„ ì¢‹ì•„ìš”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
                // alert(request.responseText);
            }
        }) ;
    }
    // ì°¸ì—¬í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì±„íŒ…ì— ì°¸ì—¬

    function joinCrew(){ //commentId(parent)
        // $("#joinMember").empty();  // ì°¸ì—¬ ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
        const crewId = document.getElementById("crewIdJoin").value;
        // const roomId = $("#crewIdJoin").val();
        const username = $("#principalJoin").val();
        // const roomName = $("#crewName").val();
        $.ajax({
            type: "POST",
            url: "/view/v1/crews/"+crewId+"/joinCrew",
            dataType: "json",
            success: function (data) {
                console.log(data);
                switch (data.joinCheck) {
                    case 0:
                        alert("ì´ë¯¸ ì°¸ì—¬í•œ ëª¨ì„ì…ë‹ˆë‹¤.");
                        break;
                    case 1:
                    case 2:
                        alert("ì°¸ì—¬ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                        getJoinMembers();
                        break;
                    default:
                        alert("ëª¨ì„ ì°¸ì—¬ ê°€ëŠ¥ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.")
                        break;
                }
            },
            error: function (request, status, error) {
                alert("ì°¸ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.")
                // alert(request.responseText);
            }
        }) ;
    }
    function leaveCrew(){
        const crewId = document.getElementById("crewIdJoin").value;
        // const roomId = $("#crewIdJoin").val();
        const username = $("#principalJoin").val();
        // const roomName = $("#crewName").val();
        $.ajax({
            type: "DELETE",
            url: "/view/v1/crews/"+crewId+"/leaveCrew",
            dataType: "json",
            success: function (data) {
                console.log(data);
                alert(data.message);
                getJoinMembers();
            },
            error: function (request, status, error) {
                alert("ì°¸ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.")
                // alert(request.responseText);
            }
        }) ;
    }
    function getJoinMembers(){

        const principal = $("#principal").val(); // username
        $("#joinMember").empty();  // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
        const crewId = document.getElementById("crewIdComment").value;
        $.ajax({
            type:"GET",
            url:"/view/v1/crews/"+ crewId +"/joinCrew",
            dataType:"json",
            success:function (data) {
                console.log(data);
                var html = " ";
                $(data).each(function(){ // comment
                    if(this.joinCheck===1){
                        html += "<ul class='list-group'>";
                        html += "<li class='list-group-item members'>";
                        html += "<div class='member' id='"+this.id+"member'>";
                        html += "<a href='javascript:; class='userImg'>";
                        html += "<img src='https://user-images.githubusercontent.com/109712249/214782553-abb78e43-e1d8-4b35-bd7f-5127e852f398.png'  width='35px' height='35px' alt='userImg' class='userImg'>";
                        html += "</a>";
                        html += "<a href='javascript:;' class='writer' style='display:inline'>" + this.userName + "</a>";

                        if(principal === this.userName) {
                            html += "<a href='javascript:;'>";
                            html += "<button type='button'  onclick='leaveCrew()' class='btn btn-outline-secondary'  id='" + this.id + "deleteMemeber'>ëª¨ì„ ë‚˜ê°€ê¸°";
                            html += "</button>";
                            html += "</a>";
                        }
                        html += "</div>";
                        html += "</div>";
                        html += "</div>";
                        html += "</li>";
                    }

                });
                html += "</ul>";

                $("#joinMember").append(html);
            }
        });
    }

</script>